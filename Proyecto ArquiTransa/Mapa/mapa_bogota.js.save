// Crear el mapa
var map = L.map('map').setView([4.710989, -74.072092], 12);

// Agregar capa de OpenStreetMap al mapa
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

// Definir el icono personalizado para los marcadores
var pinIcon = L.icon({
    iconUrl: 'pinarbol.png',
    iconSize: [20, 30]
});

// Función para agregar un marcador al mapa
function addMarker(pin) {
    var marker = L.marker([parseFloat(pin.latitud), parseFloat(pin.longitud)], {icon: pinIcon})
                    .addTo(map)
                    .bindPopup(pin.nombre)
                    .on('click', function() {
                        abrirVentana(pin.id_pin);
                    })
                    .on('mouseover', function() {
                        this.openPopup();
                    })
                    .on('mouseout', function() {
                        this.closePopup();
                    });
}

// Función para cargar los datos de los pines desde el servidor
function loadPinsData() {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'obtener_pines.php', true);
    xhr.onload = function () {
        if (xhr.status >= 200 && xhr.status < 300) {
            var pinesData = JSON.parse(xhr.responseText);
            pinesData.forEach(function(pin) {
                addMarker(pin);
            });
        } else {
            console.error('Error al obtener los datos de los pines.');
        }
    };
    xhr.send();
}
// Cargar los datos de los pines al iniciar la página
loadPinsData();


// Función para abrir la ventana al hacer clic en un pin
function abrirVentana(pin) {
console.log(pin);
 
   var cuadro = document.getElementById("cuadro");
    cuadro.style.left = "0"; // Mostrar el cuadro
    cargarInformacionTaxonomia(pin);
}

// Función para cerrar la ventana
function cerrarVentana() {
    var cuadro = document.getElementById("cuadro");
    var cuadroPos = cuadro.getBoundingClientRect();
    var cuadroWidth = cuadroPos.width;
    cuadro.style.left = "-" + cuadroWidth + "px"; // Ocultar el cuadro
}

// Función para cargar la información de la taxonomía
function cargarInformacionTaxonomia(pin) {
    var contenidoTaxonomia = document.getElementById("contenidoTaxonomia");
    contenidoTaxonomia.innerHTML = ""; // Limpiar el contenido anterior

    var xhrTaxonomia = new XMLHttpRequest();
    xhrTaxonomia.open('GET', 'obtener_planta.php?id=' + pin, true);
    xhrTaxonomia.onload = function () {
        if (xhrTaxonomia.status >= 200 && xhrTaxonomia.status < 300) {
            var plantaData = JSON.parse(xhrTaxonomia.responseText);
            var propiedades = ["Reino", "División", "Clase", "Orden", "Familia", "Género", "Especie"];
            var lista = document.createElement("ul");
            propiedades.forEach(function(propiedad) {
                var li = document.createElement("li");
                li.textContent = `${propiedad}: ${plantaData[propiedad.toLowerCase()]}`;
                lista.appendChild(li);
            });
            contenidoTaxonomia.appendChild(lista); // Agregar la lista al contenido de la taxonomía
        } else {
            console.error('Error al obtener la información de la taxonomía.');
            contenidoTaxonomia.textContent = 'Error al cargar la información de la taxonomía.';
        }
    };
    xhrTaxonomia.send();
}

